/*! For license information please see background.js.LICENSE.txt */
(()=>{var e={416:(e,r,t)=>{"use strict";r.browser=t(150)},150:function(e,r){var t,n,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[e],t=function(e){"use strict";if("undefined"==typeof browser||Object.getPrototypeOf(browser)!==Object.prototype){const r="The message port closed before a response was received.",t="Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)",n=e=>{const n={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(n).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(e,r=undefined){super(r),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const a=e=>e&&"object"==typeof e&&"function"==typeof e.then,s=(r,t)=>(...n)=>{e.runtime.lastError?r.reject(new Error(e.runtime.lastError.message)):t.singleCallbackArg||n.length<=1&&!1!==t.singleCallbackArg?r.resolve(n[0]):r.resolve(n)},i=e=>1==e?"argument":"arguments",c=(e,r)=>function(t,...n){if(n.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${i(r.minArgs)} for ${e}(), got ${n.length}`);if(n.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${i(r.maxArgs)} for ${e}(), got ${n.length}`);return new Promise(((o,a)=>{if(r.fallbackToNoCallback)try{t[e](...n,s({resolve:o,reject:a},r))}catch(a){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,a),t[e](...n),r.fallbackToNoCallback=!1,r.noCallback=!0,o()}else r.noCallback?(t[e](...n),o()):t[e](...n,s({resolve:o,reject:a},r))}))},l=(e,r,t)=>new Proxy(r,{apply:(r,n,o)=>t.call(n,e,...o)});let u=Function.call.bind(Object.prototype.hasOwnProperty);const g=(e,r={},t={})=>{let n=Object.create(null),o={has:(r,t)=>t in e||t in n,get(o,a,s){if(a in n)return n[a];if(!(a in e))return;let i=e[a];if("function"==typeof i)if("function"==typeof r[a])i=l(e,e[a],r[a]);else if(u(t,a)){let r=c(a,t[a]);i=l(e,e[a],r)}else i=i.bind(e);else if("object"==typeof i&&null!==i&&(u(r,a)||u(t,a)))i=g(i,r[a],t[a]);else{if(!u(t,"*"))return Object.defineProperty(n,a,{configurable:!0,enumerable:!0,get:()=>e[a],set(r){e[a]=r}}),i;i=g(i,r[a],t["*"])}return n[a]=i,i},set:(r,t,o,a)=>(t in n?n[t]=o:e[t]=o,!0),defineProperty:(e,r,t)=>Reflect.defineProperty(n,r,t),deleteProperty:(e,r)=>Reflect.deleteProperty(n,r)},a=Object.create(e);return new Proxy(a,o)},m=e=>({addListener(r,t,...n){r.addListener(e.get(t),...n)},hasListener:(r,t)=>r.hasListener(e.get(t)),removeListener(r,t){r.removeListener(e.get(t))}}),p=new o((e=>"function"!=typeof e?e:function(r){const t=g(r,{},{getContent:{minArgs:0,maxArgs:0}});e(t)}));let f=!1;const d=new o((e=>"function"!=typeof e?e:function(r,n,o){let s,i,c=!1,l=new Promise((e=>{s=function(r){f||(console.warn(t,(new Error).stack),f=!0),c=!0,e(r)}}));try{i=e(r,n,s)}catch(e){i=Promise.reject(e)}const u=!0!==i&&a(i);if(!0!==i&&!u&&!c)return!1;const g=e=>{e.then((e=>{o(e)}),(e=>{let r;r=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",o({__mozWebExtensionPolyfillReject__:!0,message:r})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)}))};return g(u?i:l),!0})),h=({reject:t,resolve:n},o)=>{e.runtime.lastError?e.runtime.lastError.message===r?n():t(new Error(e.runtime.lastError.message)):o&&o.__mozWebExtensionPolyfillReject__?t(new Error(o.message)):n(o)},A=(e,r,t,...n)=>{if(n.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${i(r.minArgs)} for ${e}(), got ${n.length}`);if(n.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${i(r.maxArgs)} for ${e}(), got ${n.length}`);return new Promise(((e,r)=>{const o=h.bind(null,{resolve:e,reject:r});n.push(o),t.sendMessage(...n)}))},v={devtools:{network:{onRequestFinished:m(p)}},runtime:{onMessage:m(d),onMessageExternal:m(d),sendMessage:A.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:A.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},b={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return n.privacy={network:{"*":b},services:{"*":b},websites:{"*":b}},g(e,v,n)};if("object"!=typeof chrome||!chrome||!chrome.runtime||!chrome.runtime.id)throw new Error("This script should only be loaded in a browser extension.");e.exports=n(chrome)}else e.exports=browser},void 0===(o="function"==typeof t?t.apply(r,n):t)||(e.exports=o)},61:(e,r,t)=>{var n=t(698).default;function o(){"use strict";e.exports=o=function(){return r},e.exports.__esModule=!0,e.exports.default=e.exports;var r={},t=Object.prototype,a=t.hasOwnProperty,s=Object.defineProperty||function(e,r,t){e[r]=t.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",l=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function g(e,r,t){return Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[r]}try{g({},"")}catch(e){g=function(e,r,t){return e[r]=t}}function m(e,r,t,n){var o=r&&r.prototype instanceof d?r:d,a=Object.create(o.prototype),i=new _(n||[]);return s(a,"_invoke",{value:P(e,t,i)}),a}function p(e,r,t){try{return{type:"normal",arg:e.call(r,t)}}catch(e){return{type:"throw",arg:e}}}r.wrap=m;var f={};function d(){}function h(){}function A(){}var v={};g(v,c,(function(){return this}));var b=Object.getPrototypeOf,w=b&&b(b(O([])));w&&w!==t&&a.call(w,c)&&(v=w);var y=A.prototype=d.prototype=Object.create(v);function x(e){["next","throw","return"].forEach((function(r){g(e,r,(function(e){return this._invoke(r,e)}))}))}function T(e,r){function t(o,s,i,c){var l=p(e[o],e,s);if("throw"!==l.type){var u=l.arg,g=u.value;return g&&"object"==n(g)&&a.call(g,"__await")?r.resolve(g.__await).then((function(e){t("next",e,i,c)}),(function(e){t("throw",e,i,c)})):r.resolve(g).then((function(e){u.value=e,i(u)}),(function(e){return t("throw",e,i,c)}))}c(l.arg)}var o;s(this,"_invoke",{value:function(e,n){function a(){return new r((function(r,o){t(e,n,r,o)}))}return o=o?o.then(a,a):a()}})}function P(e,r,t){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return C()}for(t.method=o,t.arg=a;;){var s=t.delegate;if(s){var i=E(s,t);if(i){if(i===f)continue;return i}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===n)throw n="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);n="executing";var c=p(e,r,t);if("normal"===c.type){if(n=t.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:t.done}}"throw"===c.type&&(n="completed",t.method="throw",t.arg=c.arg)}}}function E(e,r){var t=r.method,n=e.iterator[t];if(void 0===n)return r.delegate=null,"throw"===t&&e.iterator.return&&(r.method="return",r.arg=void 0,E(e,r),"throw"===r.method)||"return"!==t&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+t+"' method")),f;var o=p(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,f;var a=o.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,f):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function S(e){var r={tryLoc:e[0]};1 in e&&(r.catchLoc=e[1]),2 in e&&(r.finallyLoc=e[2],r.afterLoc=e[3]),this.tryEntries.push(r)}function k(e){var r=e.completion||{};r.type="normal",delete r.arg,e.completion=r}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function O(e){if(e){var r=e[c];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var t=-1,n=function r(){for(;++t<e.length;)if(a.call(e,t))return r.value=e[t],r.done=!1,r;return r.value=void 0,r.done=!0,r};return n.next=n}}return{next:C}}function C(){return{value:void 0,done:!0}}return h.prototype=A,s(y,"constructor",{value:A,configurable:!0}),s(A,"constructor",{value:h,configurable:!0}),h.displayName=g(A,u,"GeneratorFunction"),r.isGeneratorFunction=function(e){var r="function"==typeof e&&e.constructor;return!!r&&(r===h||"GeneratorFunction"===(r.displayName||r.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,A):(e.__proto__=A,g(e,u,"GeneratorFunction")),e.prototype=Object.create(y),e},r.awrap=function(e){return{__await:e}},x(T.prototype),g(T.prototype,l,(function(){return this})),r.AsyncIterator=T,r.async=function(e,t,n,o,a){void 0===a&&(a=Promise);var s=new T(m(e,t,n,o),a);return r.isGeneratorFunction(t)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},x(y),g(y,u,"Generator"),g(y,c,(function(){return this})),g(y,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var r=Object(e),t=[];for(var n in r)t.push(n);return t.reverse(),function e(){for(;t.length;){var n=t.pop();if(n in r)return e.value=n,e.done=!1,e}return e.done=!0,e}},r.values=O,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function t(t,n){return s.type="throw",s.arg=e,r.next=t,n&&(r.method="next",r.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var i=a.call(o,"catchLoc"),c=a.call(o,"finallyLoc");if(i&&c){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(e,r){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=r&&r<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=r,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(s)},complete:function(e,r){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&r&&(this.next=r),f},finish:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),k(t),f}},catch:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.tryLoc===e){var n=t.completion;if("throw"===n.type){var o=n.arg;k(t)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,t){return this.delegate={iterator:O(e),resultName:r,nextLoc:t},"next"===this.method&&(this.arg=void 0),f}},r}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},698:e=>{function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},687:(e,r,t)=>{var n=t(61)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},r={};function t(n){var o=r[n];if(void 0!==o)return o.exports;var a=r[n]={exports:{}};return e[n].call(a.exports,a,a.exports,t),a.exports}t.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},t.d=(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),(()=>{"use strict";function e(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function r(r,t){if(r){if("string"==typeof r)return e(r,t);var n=Object.prototype.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(r,t):void 0}}function n(t){return function(r){if(Array.isArray(r))return e(r)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,o,a,s,i=[],c=!0,l=!1;try{if(a=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=a.call(t)).done)&&(i.push(n.value),i.length!==r);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=t.return&&(s=t.return(),Object(s)!==s))return}finally{if(l)throw o}}return i}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,r,t,n,o,a,s){try{var i=e[a](s),c=i.value}catch(e){return void t(e)}i.done?r(c):Promise.resolve(c).then(n,o)}function s(e){return function(){var r=this,t=arguments;return new Promise((function(n,o){var s=e.apply(r,t);function i(e){a(s,n,o,i,c,"next",e)}function c(e){a(s,n,o,i,c,"throw",e)}i(void 0)}))}}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function c(e){var r=function(e,r){if("object"!==i(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"===i(r)?r:String(r)}function l(e,r,t){return(r=c(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var u=t(687),g=t.n(u);Function.prototype.asPromise||Object.defineProperty(Function.prototype,"asPromise",{configurable:!1,enumerable:!1,value:function(){for(var e=this,r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];var o=t.findIndex((function(e){return e===Promise.resolve})),a=t.findIndex((function(e){return e===Promise.reject}));return new Promise((function(r,n){var s=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];if(chrome&&chrome.runtime&&chrome.runtime.lastError)n(chrome.runtime.lastError);else if(t.length>1)r(t);else{var a=t[0];r(a)}};-1!==o?t.splice(o,1,s):t.push(s),-1!==a&&t.splice(a,1,n);try{e.apply(void 0,t)}catch(e){n(e)}}))},writable:!1});var m,p=t(416);function f(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function d(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"==typeof e)return h(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return h(e,r)}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==t.return||t.return()}finally{if(i)throw a}}}}function h(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}!function(e){e.ON_CHAT_LOGGED_IN="ON_CHAT_LOGGED_IN",e.CHAT_TEXT_MESSAGE="CHAT_TEXT_MESSAGE",e.GRAB_PAGE_INNER_TEXT="GRAB_PAGE_INNER_TEXT",e.GRAB_PAGE_SELECTION_TEXT="GRAB_PAGE_SELECTION_TEXT",e.GRAB_PAGE_TITLE="GRAB_PAGE_TITLE",e.GET_CHAT_ADAPTER="GET_CHAT_ADAPTER",e.SET_CHAT_ADAPTER="SET_CHAT_ADAPTER",e.GET_CHAT_READY="GET_CHAT_READY",e.GET_CHAT_STATUS="GET_CHAT_STATUS",e.OPEN_CHATVIEW="OPEN_CHATVIEW",e.OPERATIONAL_REPORT="OPERATIONAL_REPORT",e.REGISTER_CHAT_PORT="REGISTER_CHAT_PORT",e.LOGGED_IN_REPORT="LOGGED_IN_REPORT",e.ACTIVATE_CASHBACK="ACTIVATE_CASHBACK",e.FETCH_OFFER_DATA="FETCH_OFFER_DATA",e.OFFER_DATA="OFFER_DATA",e.SEND_STATS="SEND_STATS",e.MARK_CLOSED="MARK_CLOSED",e.SETTINGS_FOR_PAGE="SETTINGS_FOR_PAGE",e.GET_VERSION="GET_VERSION",e.VERSION="VERSION",e.SET_LANGUAGE="SET_LANGUAGE",e.SET_STAGING="SET_STAGING"}(m||(m={}));var A=function(){function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),l(this,"registeredCallbacks",{}),l(this,"registeredCallbacksOnce",{})}var r,t,n;return r=e,(t=[{key:"on",value:function(e,r,t){var n=e;Array.isArray(n)||(n=[e]);var o,a=d(n);try{for(a.s();!(o=a.n()).done;){var s=o.value;this.registeredCallbacks[s]||(this.registeredCallbacks[s]=[]),this.registeredCallbacks[s].splice(0,0,r)}}catch(e){a.e(e)}finally{a.f()}return this}},{key:"removeListener",value:function(e,r){if(this.registeredCallbacks[e]){for(var t=this.registeredCallbacks[e].length-1;t>=0;t-=1)this.registeredCallbacks[e][t]===r&&this.registeredCallbacks[e].splice(t,1);this.registeredCallbacks[e].indexOf(r)}}},{key:"once",value:function(e,r,t){this.registeredCallbacksOnce[e]||(this.registeredCallbacksOnce[e]=[]);var n=!1;return t&&this.registeredCallbacksOnce[e].forEach((function(e){if(e.id===t)return e.fn=r,void(n=!0)})),n||this.registeredCallbacksOnce[e].push({id:t,fn:r}),this}},{key:"dispatch",value:function(e,r,t,n){var o=this;return this.registeredCallbacks[e]&&this.registeredCallbacks[e].forEach((function(e){e.call(o,r,t,n)})),this.registeredCallbacksOnce[e]&&(this.registeredCallbacksOnce[e].forEach((function(e){e.fn.call(o,r,t,n)})),delete this.registeredCallbacksOnce[e]),this}}])&&f(r.prototype,t),n&&f(r,n),Object.defineProperty(r,"prototype",{writable:!1}),e}();function v(e){return new Promise((function(r){return setTimeout(r,e)}))}var b="commands-storage",w="highlighted-text",y="shorten-text",x="prompt-data";function T(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function P(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?T(Object(t),!0).forEach((function(r){l(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):T(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var E=new Map,S=new Map,k="ChatGpt",_=0;opr.browserSidebarPrivate.reloadPanelsUsingPrefId(k);var O=function(){var e=s(g().mark((function e(){var r,t,n,o,a,s,i,c,l,u,m,p,f,d,h,A,v,b;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=k,e.prev=1,e.next=4,null===(n=opr.browserSidebarPrivate)||void 0===n||null===(o=n.isVisible)||void 0===o?void 0:o.asPromise();case 4:return e.sent||null===(u=opr.browserSidebarPrivate)||void 0===u||u.setVisible(!0),e.next=8,null===(a=opr.browserSidebarPrivate)||void 0===a||null===(s=a.getItemsInfo)||void 0===s?void 0:s.asPromise();case 8:if(m=e.sent,p=null==m?void 0:m.find((function(e){return e.pref_id===r})),f=null==p?void 0:p.visible,!p||f){e.next=14;break}return e.next=14,null===(d=opr.browserSidebarPrivate)||void 0===d||null===(h=d.setItemVisibleUsingPrefId)||void 0===h?void 0:h.asPromise(r,!0);case 14:return e.next=16,null===(i=opr.browserSidebarPrivate)||void 0===i||null===(c=i.getPanelStatus)||void 0===c?void 0:c.asPromise();case 16:if(A=e.sent,t=null==A?void 0:A.shown_item_pref_id,v=null==A?void 0:A.docked,b=!(null==A||!A.shown_item_pref_id),!v||!b||t!==r){e.next=22;break}return e.abrupt("return");case 22:return v&&!b&&opr.browserSidebarPrivate.undockPanel(),null===(l=opr.browserSidebarPrivate)||void 0===l||l.expandItemUsingPrefId(r),e.next=26,new Promise((function(e){setTimeout(e,500)}));case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(1),console.error("[service-worker]",e.t0);case 31:case"end":return e.stop()}}),e,null,[[1,28]])})));return function(){return e.apply(this,arguments)}}(),C=new A,I=function(){var e=s(g().mark((function e(r,t){var n,o,a,s,i,c;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=0;case 1:if(n||!(o<30)){e.next=9;break}if(n=E.get(r)){e.next=7;break}return e.next=6,v(100);case 6:o+=1;case 7:e.next=1;break;case 9:if(n){e.next=12;break}return alert("Try reload ChatGPT Panel manually"),e.abrupt("return",{error:"there is no port for currentActiveWindowId",operational:!1});case 12:return a=++_,s={type:m.GET_CHAT_STATUS,response_id:a},n.postMessage(s),i=new Promise((function(e,r){S.set(a,{tabId:t,port:n,reject:r,resolve:e})})),S.set(a,P({promise:i},S.get(a))),e.next=19,i;case 19:return c=e.sent,e.abrupt("return",c);case 21:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),j=function(){var e=s(g().mark((function e(r,t,n){var o,a,s,i,c;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=E.get(r)){e.next=4;break}return alert("goToChatView: there is no port for currentActiveWindowId"),e.abrupt("return",{error:"there is no port for currentActiveWindowId",operational:!1});case 4:if(a=++_,s={type:m.OPEN_CHATVIEW,response_id:a},o.postMessage(s),console.log("[service-worker] [chatGPTGoToChatView]",s,n),n){e.next=19;break}return i=new Promise((function(e,n){S.set(a,{type:"operational-waiter",tabId:t,windowId:r,port:o,resolve:e,reject:n})})),S.set(a,P({promise:i},S.get(a))),console.log("[service-worker] [chatGPTGoToChatView] - chatGPTPromisesBucket - get",S.get(a),S),e.next=14,i;case 14:if(c=e.sent,console.log("[service-worker] [chatgpt] goToChatView - openChatViewResult",c),!c.operational){e.next=18;break}return e.abrupt("return",c);case 18:return e.abrupt("return",c);case 19:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),G=function(){var e=s(g().mark((function e(r,t,n,o){var a,s,i,c,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[sendToChatGPT]",r,n,o),C.dispatch("shorten-dry-lock"),e.next=4,O();case 4:return console.log("[sendToChatGPT] - open panel"),e.next=7,I(r);case 7:if(a=e.sent,console.log("[sendToChatGPT] - status",a),null!=a&&a.operational){e.next=23;break}return C.dispatch("shorten-dry-unlock"),C.dispatch("shorten-update"),console.log("[sendToChatGPT] - not operational"),e.prev=13,e.next=16,j(r,t);case 16:console.log("[sendToChatGPT] - chatGPTGoToChatView"),e.next=23;break;case 19:return e.prev=19,e.t0=e.catch(13),console.log("[service-worker] [sendToChatGPT] [chatgpt] cannot open chat view",e.t0),e.abrupt("return");case 23:if(console.log("[service-worker] [sendToChatGPT] [chatgpt] - status",a),!(s=E.get(r))){e.next=38;break}return i=++_,c={type:m.CHAT_TEXT_MESSAGE,text:n,replace_question:o,response_id:i},s.postMessage(c),console.log("[service-worker] [sendToChatGPT] [posted message] - status",c),l=new Promise((function(e,r){S.set(i,{tabId:t,port:s,resolve:e,reject:r})})),S.set(i,P({promise:l},S.get(i))),console.log("[service-worker] [sendToChatGPT] [send] ",S.get(i)),C.dispatch("shorten-update"),console.log("[service-worker] [sendToChatGPT] [returning promise]",l),e.abrupt("return",l);case 38:return e.abrupt("return",Promise.resolve({error:"No ChatGPT port for current window, please reload ChatGPT panel."}));case 39:case"end":return e.stop()}}),e,null,[[13,19]])})));return function(r,t,n,o){return e.apply(this,arguments)}}();function R(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function N(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?R(Object(t),!0).forEach((function(r){l(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):R(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var L=new Map,D=new Map,M="ChatSonic",B=0;opr.browserSidebarPrivate.reloadPanelsUsingPrefId(M);var F=function(){var e=s(g().mark((function e(){var r,t,n,o,a,s,i,c,l,u,m,p,f,d,h,A,v,b;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=M,e.prev=1,e.next=4,null===(n=opr.browserSidebarPrivate)||void 0===n||null===(o=n.isVisible)||void 0===o?void 0:o.asPromise();case 4:return e.sent||null===(u=opr.browserSidebarPrivate)||void 0===u||u.setVisible(!0),e.next=8,null===(a=opr.browserSidebarPrivate)||void 0===a||null===(s=a.getItemsInfo)||void 0===s?void 0:s.asPromise();case 8:if(m=e.sent,p=null==m?void 0:m.find((function(e){return e.pref_id===r})),f=null==p?void 0:p.visible,!p||f){e.next=14;break}return e.next=14,null===(d=opr.browserSidebarPrivate)||void 0===d||null===(h=d.setItemVisibleUsingPrefId)||void 0===h?void 0:h.asPromise(r,!0);case 14:return e.next=16,null===(i=opr.browserSidebarPrivate)||void 0===i||null===(c=i.getPanelStatus)||void 0===c?void 0:c.asPromise();case 16:if(A=e.sent,t=null==A?void 0:A.shown_item_pref_id,v=null==A?void 0:A.docked,b=!(null==A||!A.shown_item_pref_id),!v||!b||t!==r){e.next=22;break}return e.abrupt("return");case 22:return v&&!b&&opr.browserSidebarPrivate.undockPanel(),null===(l=opr.browserSidebarPrivate)||void 0===l||l.expandItemUsingPrefId(r),e.next=26,new Promise((function(e){setTimeout(e,500)}));case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(1),console.error("[service-worker] [chatsonic]",e.t0);case 31:case"end":return e.stop()}}),e,null,[[1,28]])})));return function(){return e.apply(this,arguments)}}(),V=new A,H=function(){var e=s(g().mark((function e(r,t){var n,o,a,s,i,c;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=0;case 1:if(n||!(o<30)){e.next=9;break}if(n=L.get(r)){e.next=7;break}return e.next=6,v(100);case 6:o+=1;case 7:e.next=1;break;case 9:if(n){e.next=12;break}return alert("no port connection from panel, please reload chatsonic panel"),e.abrupt("return",{error:"there is no port for currentActiveWindowId",operational:!1});case 12:return a=++B,s={type:m.GET_CHAT_STATUS,response_id:a},n.postMessage(s),i=new Promise((function(e,r){D.set(a,{tabId:t,port:n,resolve:e,reject:r})})),D.set(a,N({promise:i},D.get(a))),e.next=19,i;case 19:return c=e.sent,e.abrupt("return",c);case 21:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),U=function(){var e=s(g().mark((function e(r,t,n){var o,a,s,i,c;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=L.get(r)){e.next=4;break}return alert("goToChatView: there is no port for currentActiveWindowId"),e.abrupt("return",{error:"there is no port for currentActiveWindowId",operational:!1});case 4:if(a=++B,s={type:m.OPEN_CHATVIEW,response_id:a},o.postMessage(s),n){e.next=17;break}return i=new Promise((function(e,n){D.set(a,{type:"operational-waiter",windowId:r,tabId:t,port:o,resolve:e,reject:n})})),D.set(a,N({promise:i},D.get(a))),e.next=12,i;case 12:if(c=e.sent,console.log("[service-worker] [chatsonic] goToChatView - openChatViewResult",c),!c.operational){e.next=16;break}return e.abrupt("return",c);case 16:return e.abrupt("return",c);case 17:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),W=function(){var e=s(g().mark((function e(r,t,n,o){var a,s,i,c,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V.dispatch("shorten-dry-lock"),e.next=3,F();case 3:return e.next=5,H(r);case 5:if(null!=(a=e.sent)&&a.operational){e.next=18;break}return V.dispatch("shorten-dry-unlock"),V.dispatch("shorten-update"),e.prev=9,e.next=12,U(r,t);case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(9),console.log("[service-worker] [chatsonic] cannot open chat view",e.t0),e.abrupt("return");case 18:if(console.log("[service-worker] [chatsonic] - status",a),!(s=L.get(r))){e.next=28;break}return i=++B,c={type:m.CHAT_TEXT_MESSAGE,text:n,replace_question:o,response_id:i},s.postMessage(c),l=new Promise((function(e,r){D.set(i,{tabId:t,port:s,resolve:e,reject:r})})),D.set(i,N({promise:l},D.get(i))),V.dispatch("shorten-update"),e.abrupt("return",l);case 28:return e.abrupt("return",Promise.resolve({error:"No active ChatSonic port for current window, please reload ChatSonic panel."}));case 29:case"end":return e.stop()}}),e,null,[[9,14]])})));return function(r,t,n,o){return e.apply(this,arguments)}}(),$=[{name:"en",value:"en"},{name:"de",value:"de"},{name:"fr",value:"fr"},{name:"pl",value:"pl"},{name:"no",value:"nb"},{name:"se",value:"sv"}];const q=JSON.parse('[{"ai":"ChatGPT","command":"Summarise this text : \\"%s\\" in 3 bullet points","id":"Summarise in 3 bullet points-1678284624351402","label":"Summarise in 3 bullet points","language":"en","maxValue":"","minValue":"30","placeholder":"","url":"","shortenPrompt":true,"highlightedPrompt":true},{"ai":"ChatGPT","command":"Translate this phrase: \\"%s\\" to spanish","id":"Translate to spanish-1678284624351678","label":"Translate to spanish","language":"en","maxValue":"","minValue":"1","placeholder":"","url":"","shortenPrompt":true,"highlightedPrompt":true},{"ai":"ChatSonic","command":"Show me relevant content to this: \\"%s\\"","id":"Show me relevant content-1678284624351983","label":"Show me relevant content","language":"en","maxValue":"","minValue":"20","placeholder":"","url":"","shortenPrompt":true,"highlightedPrompt":true}]');function X(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"==typeof e)return z(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return z(e,r)}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==t.return||t.return()}finally{if(i)throw a}}}}function z(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var K,Y,Z,J,Q,ee=p.browser.runtime.getManifest(),re="chatgpt";Object.assign(globalThis,{chatGPTPorts:E,chatSonicPorts:L,chatSonicPromisesBucket:D,chatGPTPromisesBucket:S,getChatGPTStatus:I,getChatSonicStatus:H,currentActiveWindowId:Q});var te=function(e){var r,t,n=new XMLHttpRequest,o=Object.entries({v:1,tid:"UA-260511808-1",cid:K,ds:"extension",t:"event",ec:e.category,ea:e.action,el:e.label,ev:e.value}).filter((function(e){return void 0!==e[1]})).map((function(e){return e[0]+"="+encodeURIComponent(e[1])})).join("&");(n.open("POST","https://www.google-analytics.com/collect",!0),n.send(o),window.opr&&opr.statsPrivate)&&opr.statsPrivate.recordSessionEvent("feature_events.event_cashback",JSON.stringify({action:"cashback_extension."+e.action.replace(/ |\(|\)/g,"_"),details:{category:e.category.toString(),label:null===(r=e.label)||void 0===r?void 0:r.toString(),value:null===(t=e.value)||void 0===t?void 0:t.toString()}}),opr.statsPrivate.Priority.NORMAL)},ne=function(e,r,t){console.log("[service-worker] sendToAIChat",r,J,Q);var n=J;if(!e){if(!Q)return void alert("No currentActiveWindowId, please change Tab");e=Q}switch(te({category:"event",action:"user_used_chat",label:re}),re){case"chatgpt":return G(e,n,r,t);case"chatsonic":return W(e,n,r,t)}},oe=function(){var e=s(g().mark((function e(r,t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t){e.next=4;break}return e.abrupt("return",p.browser.tabs.sendMessage(t,r).catch(console.log));case 4:return e.abrupt("return",p.browser.runtime.sendMessage(r).catch(console.log));case 5:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),ae=function(e){var r,t=X(e.entries());try{for(t.s();!(r=t.n()).done;){var n=o(r.value,2),a=n[0],s=n[1];if("operational-waiter"!==s.type)try{s.port.postMessage("poke")}catch(r){console.warn("discarding promise to broken port",{portErr:r,response_id:a,bucketObj:s}),s.reject(r),e.delete(a)}}}catch(e){t.e(e)}finally{t.f()}},se=function e(r,t){ae(S),ae(D);var o=[].concat(n(S.values()),n(D.values())).filter((function(e){return!!e.promise})).filter((function(e){return"operational-waiter"!==(null==e?void 0:e.type)})).map((function(e){return e.promise}));p.browser.pageAction.show(r),t&&t.startsWith("http")&&r===J?o.length?(opr.shodanPrivate.setShortenButtonStateForTab(r,opr.shodanPrivate.ShortenButtonState.DISABLED),Promise.all(o).finally((function(){e(r,t)}))):opr.shodanPrivate.setShortenButtonStateForTab(r,opr.shodanPrivate.ShortenButtonState.ENABLED):opr.shodanPrivate.setShortenButtonStateForTab(r,opr.shodanPrivate.ShortenButtonState.HIDDEN)},ie=function(){p.browser.tabs.query({currentWindow:!0,active:!0}).then((function(e){return e[0]&&se(e[0].id,e[0].url)}))},ce=function(e,r){var t,n=X(e.entries());try{for(n.s();!(t=n.n()).done;){var a=o(t.value,2),s=a[0],i=a[1];r(i)&&(i.reject(),e.delete(s))}}catch(e){n.e(e)}finally{n.f()}},le=function(e){ce(S,(function(r){return r.tabId===e})),ce(D,(function(r){return r.tabId===e}))},ue=function(){var e,r;K||(K=(1e7.toString()+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(+e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+e/4).toString(16)})),p.browser.storage.local.set({uniqueID:K}),te({category:"event",action:"user_registered"})),e=chrome.i18n.getUILanguage(),Y!==e&&(Y=e,p.browser.storage.local.set({language:Y})),r=q,(!Z||Z.length<=0)&&(Z=r,chrome.storage.local.set(l({},b,Z))),p.browser.runtime.onMessage.addListener(function(){var e=s(g().mark((function e(r,t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("[service-worker] browser.runtime.onMessage",r),e.t0=r.type,e.next=e.t0===m.ON_CHAT_LOGGED_IN?4:e.t0===m.SET_CHAT_ADAPTER?6:e.t0===m.GET_CHAT_ADAPTER?8:e.t0===m.CHAT_TEXT_MESSAGE?9:e.t0===m.SEND_STATS?10:e.t0===m.GET_VERSION?11:13;break;case 4:return E.size&&E.forEach((function(e){return e.postMessage(r)})),e.abrupt("break",13);case 6:return re=r.adapter,e.abrupt("return",Promise.resolve(re));case 8:return e.abrupt("return",Promise.resolve(re));case 9:return e.abrupt("return",ne(void 0,r.text,r.replace_question));case 10:return e.abrupt("break",13);case 11:return oe({type:m.VERSION,data:{version:ee.version}},null===(n=t.tab)||void 0===n?void 0:n.id),e.abrupt("break",13);case 13:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}()),p.browser.tabs.onCreated.addListener((function(e){J&&opr.shodanPrivate.setShortenButtonStateForTab(J,opr.shodanPrivate.ShortenButtonState.HIDDEN),J=e.id,se(e.id,e.url)})),p.browser.tabs.onUpdated.addListener((function(e,r,t){return se(e,t.url)})),p.browser.tabs.onActivated.addListener((function(e){Q=e.windowId,console.log("[service-worker] onActivated",e),p.browser.tabs.get(e.tabId).then((function(r){J&&opr.shodanPrivate.setShortenButtonStateForTab(J,opr.shodanPrivate.ShortenButtonState.HIDDEN),J=e.tabId,se(e.tabId,r.url)}))})),p.browser.tabs.onRemoved.addListener(le),p.browser.tabs.onReplaced.addListener(le),p.browser.tabs.onDetached.addListener(le),p.browser.tabs.onUpdated.addListener(le),ie(),opr.shodanPrivate.onAddressBarShortenButton.addListener(function(){var e=s(g().mark((function e(r){var t,n,o,a,s,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.browser.tabs.executeScript({file:"/domdistiller_wrapped.js"});case 2:return n=e.sent,o=n[0].textOnly.trim().split(/\s+/).length>50?n[0].textOnly:n[0].bodyInnerTextOnly,a=n[0][1],s=r.tabId,e.next=8,p.browser.tabs.query({currentWindow:!0}).then((function(e){return e.filter((function(e){return e.id===Number(s)}))[0].url}));case 8:i=e.sent,chrome.storage.local.set((l(t={},w,""),l(t,y,{title:a,innerText:o}),t)),chrome.storage.local.get((function(e){var t=e[b]||[],n=e.language.split("-")[0];if(pe(n)||(n="en"),t.length>0){t=t.filter((function(e){return e.language===n&&!0===e.shortenPrompt}));var a=fe(t,o,i);chrome.storage.local.set(l({},x,a)),a.length>0&&opr.shodanPrivate.showPopupForShortenButton(Number(r.tabId),me(a,!0))}}));case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}());var t=function(){opr.shodanPrivate.setShortenButtonStateForTab(J,opr.shodanPrivate.ShortenButtonState.DISABLED)},n=function(){opr.shodanPrivate.setShortenButtonStateForTab(J,opr.shodanPrivate.ShortenButtonState.ENABLED)};C.on("shorten-dry-lock",t),C.on("shorten-dry-unlock",n),C.on("shorten-update",ie),V.on("shorten-dry-lock",t),V.on("shorten-dry-unlock",n),V.on("shorten-update",ie)};p.browser.storage.local.get().then((function(e){K=e.uniqueID,Y=e.language,Z=e[b],ue()}));var ge=function(e){console.info("[service-worker] ...report Active AI Ports   [".concat(e,"]"),{chatGPTPorts:E,chatSonicPorts:L})};chrome.runtime.onConnect.addListener((function(e){var r,t=e.name;switch(console.log("%c[service-worker] New AI Port [%c".concat(t,"%c]"),"background:green;color:white","background:tomato;color:white","background:green;color:white",e),t){case"chatgpt":r=S;break;case"chatsonic":r=D;break;default:throw new Error("Connection from unknown port")}e.onMessage.addListener((function(n){if("ping"===n.type)return console.debug("[service-worker] pong from port",e),void e.postMessage({type:"pong",timestamp:Date.now()});if(n.type===m.REGISTER_CHAT_PORT){switch(t){case"chatgpt":E.set(n.windowId,e);break;case"chatsonic":L.set(n.windowId,e);break;default:throw new Error("Registration from unknown port")}return console.log("%c[service-worker] Registering AI Port [%c".concat(t,"%c]"),"background:green;color:white","background:tomato;color:white","background:green;color:white",n,e),void ge("port registered")}var a=Array.from(r.entries()).filter((function(e){var r=o(e,2)[1];return"operational-waiter"===r.type&&r.windowId===n.windowId})).sort((function(e,r){return e[0]-r[0]}));if(console.log("[service-worker] operational-report waiters",a),n.type!==m.OPERATIONAL_REPORT)if("chatsonic"===t&&null!=a&&a.length&&n.type===m.LOGGED_IN_REPORT)U(n.windowId,J,!0);else{if(console.log("%c[service-worker] Response from Port [".concat(t,"]"),"background:blue;color:white",n,e),n.response_id){var s=r.get(n.response_id);return s?(s.resolve(n),void r.delete(n.response_id)):void console.error("[service-worker] Response with response_id not present in promisesBucked",n)}console.warn("[service-worker] Unknown message from port",{port:e,message:n})}else for(var i=0;i<a.length;i+=1){var c=o(a[i],2),l=c[0],u=c[1];console.log("[service-worker] operational-report response to",{response_id:l,message:n,bucketObj:u}),i===a.length-1?u.resolve(n):u.reject(),r.delete(l)}})),e.onDisconnect.addListener((function(){console.log("%c[service-worker] ON DISCONNECT","background:red;color:white",e);var r,t=X(E.entries());try{for(t.s();!(r=t.n()).done;){var n=o(r.value,2),a=n[0],s=n[1];e===s&&E.delete(a)}}catch(e){t.e(e)}finally{t.f()}var i,c=X(L.entries());try{for(c.s();!(i=c.n()).done;){var l=o(i.value,2),u=l[0],g=l[1];e===g&&L.delete(u)}}catch(e){c.e(e)}finally{c.f()}ce(S,(function(r){return r.port===e&&"operational-waiter"!==r.type})),ce(D,(function(r){return r.port===e&&"operational-waiter"!==r.type})),ie(),ge("port disconnected")}))})),opr.shodanPrivate.onTextSelected.addListener((function(e){var r,t=e.id,n=e.text,o=e.url;chrome.storage.local.set((l(r={},w,n),l(r,y,{}),r)),chrome.storage.local.get((function(e){var r=e[b]||[],a=e.language.split("-")[0];if(pe(a)||(a="en"),r.length>0){r=r.filter((function(e){return e.language===a&&!0===e.highlightedPrompt}));var s=fe(r,n,o);chrome.storage.local.set(l({},x,s)),s.length>0&&opr.shodanPrivate.showPopupForSelectedText(t,me(s,!1))}}))}));var me=function(e,r){var t=r?30:20,n=r?188:76;return e.map((function(e){e.label.length<=t?n+=28:n+=44})),n},pe=function(e){return $.flatMap((function(e){return e.value})).includes(e)},fe=function(e,r,t){var n=[];return e.map((function(e){var o,a,s;o=r.length,a=Number(e.minValue),s=Number(e.maxValue),(!a&&!s||(a&&!s?a<=o:a<=o&&o<=s))&&function(e,r){if(r){var t=new URL(r).hostname.replace(/www\./,""),n=new RegExp(t);return!!e.match(n)}return!0}(t,e.url)&&n.push(e)})),n}})()})();